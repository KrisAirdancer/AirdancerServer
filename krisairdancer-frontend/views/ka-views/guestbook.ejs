<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krisaridancer - Guestbook</title>
    <link rel="stylesheet" href="../../styles.css">
    <link rel="shortcut icon" href="../../wind-icon.png" type="image/png">
    <!-- <script src="./guestbook.js"></script> -->
</head>
<body>
    <div id="outer-div">
        <div id="content-div">
            <h1>Guestbook</h1>

            <nav id="navbar">&lt;&lt;&lt;
                <a href="http://localhost:11001/ka">Home</a>
            &gt;&gt;&gt;</nav>

            <form action="http://localhost:11001/ka/sign-guestbook">
                <p>Handle:</p>
                <div>
                    <input name="handle" type="text" maxlength="20" required>
                </div>
                <p>Favorite Website (or your own):</p>
                <div>
                    <input type="text" name="favWebsite" maxlength="300">
                </div>
                <p>Message</p>
                <div>
                    <textarea name="message" id="guestbook-message" cols="40" rows="3" maxlength="250" required></textarea>
                </div>
                <button type="submit">Sign</button>
            </form>

            <p>*timesamps in <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC time</a></p>

            <!-- Entries HTML to be generated by below scripts and injected here -->
            <div id="guestbook-entries"></div>
        </div>
    </div>
</body>
<style></style>
<script>

    try {
	    fetch('../guestbook.json')
	        .then(response => response.json())
	        .then(guestbook => {

                // Generate HTML of guestbook entries
                
                let guestbookHTML = [];

	            guestbook.forEach(entry => {
	                
	                guestbookHTML.push('<div>');
	                guestbookHTML.push(`<p>[${entry.timestamp}]</p>`);
	                guestbookHTML.push(`<p>Favorite Website: ${entry.favWebsite}</p>`);
	                guestbookHTML.push(`<p><strong>${entry.handle}:</strong> ${entry.message}</p>`);
	
	                guestbookHTML.push('</div>');
	            });
	
	            // Apply HTML to DOM
                
                let guestbookEntries = document.querySelector('#guestbook-entries');

                if (guestbookHTML.length === 0)
                {
                    guestbookEntries.innerHTML = '<p>No entries yet. Add one!</p>';
                }
                else
                {
                    guestbookEntries.innerHTML = guestbookHTML.join('');
                }
	
	        });
    }
    catch (error)
    {
        // console.log(error);
        guestbookEntries.innerHTML = '<p>No entries yet. Add one!</p>';
    }

    



</script>
</html>

<!--
    TODO:
    
    [ ] Page should populate all entries from guestbook.json when loaded
    [ ] Add form to page to allow users to enter a message
    [ ] Messages should be saved to guestbook.json
-->