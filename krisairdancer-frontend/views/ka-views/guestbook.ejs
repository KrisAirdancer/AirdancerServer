<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krisaridancer - Guestbook</title>
    <link rel="stylesheet" href="../../styles.css">
    <link rel="shortcut icon" href="../../wind-icon.png" type="image/png">
    <!-- <script src="./guestbook.js"></script> -->
</head>
<body>
    <div id="outer-div">
        <div id="content-div">
            <h1>Guestbook</h1>

            <nav id="navbar">&lt;&lt;&lt;
                <a href="http://localhost:11001/ka">Home</a>
            &gt;&gt;&gt;</nav>

            <form action="http://localhost:11001/ka/sign-guestbook" id="guestbookForm">
                <p><strong>Handle:</strong></p>
                <div>
                    <input name="handle" type="text" maxlength="20" id="handleInput" required>
                </div>
                <p><strong>Favorite Website:</strong></p>
                <div>
                    <input type="text" name="favWebsite" maxlength="300" id="favwebInput">
                </div>
                <p><strong>Message:</strong></p>
                <div>
                    <textarea name="message" cols="40" rows="3" maxlength="250" id="messageTextArea" required></textarea>
                </div>
                <button type="submit" id="submitButton">Sign</button>
            </form>

            <p id="timestampMessage">*timesamps in <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC time</a></p>

            <!-- Entries HTML to be generated by below scripts and injected here -->
            <div id="guestbookEntries"></div>
        </div>
    </div>
</body>
<style>

    /***** Form Styles *****/

    input {
        background-color: var(--blue);
        color: var(--orange);
        border: 1px solid var(--orange);
        border-radius: 5px;
    }

    #guestbookForm {
        border: 2px solid var(--orange);
        border-radius: 10px;
        padding: 10px;
        max-width: 700px;
        width: 325px;
        margin: 10px 0px 5px 0px;
    }

    #handleInput {
        width: 250px;
    }

    #favwebInput {
        width: 250px;
    }

    #messageTextArea {
        width: 300px;
        background-color: var(--blue);
        color: var(--orange);
        border: 1px solid var(--orange);
        border-radius: 5px;
    }

    #submitButton {
        background-color: var(--blue);
        color: var(--orange);
        border: 1px solid var(--orange);
        border-radius: 5px;
    }

    #submitButton:active {
        color: #ffffff;
        border-color: white;
    }

    #timestampMessage {
        margin: 0px 0px 10px 0px;
    }

    /***** Entries Styles *****/

    p {
        margin: 5px 0px 5px 0px;
    }

    #guestbookEntries {
        max-width: 700px;
        width: 700px;
    }

    .guestbookEntry {
        border: 2px solid var(--orange);
        border-radius: 5px;
        margin-bottom: 10px;
        padding: 5px 10px 5px 10px;
    }

    .guestbookHandleMessage {
        max-width: 675px;
        width: 675px;
        word-wrap: break-word;
    }


</style>
<script>

    try {
	    fetch('../guestbook.json')
	        .then(response => response.json())
	        .then(guestbook => {

                // Generate HTML of guestbook entries

                let guestbookHTML = [];

	            guestbook.forEach(entry => {
	
                    guestbookHTML.push(
                        '<div class="guestbookEntry">' +
                            `<p class="guestbookHandleMessage"><strong>${entry.handle}:</strong> ${entry.message}</p>` +
                            `<p><strong>Favorite Website:</strong> ${entry.favWebsite}</p>` +
                            // `<p><strong>Favorite Website:</strong> <a href=\"https://${entry.favWebsite}\">${entry.favWebsite}</a></p>` + // This is a start at hyperlinking the links
                            `<p>~ ${entry.timestamp} ~</p>` +
                        '</div>'
                    );
	            });

                guestbookHTML.reverse();
	
	            // Apply HTML to DOM
                
                let guestbookEntries = document.querySelector('#guestbookEntries');

                if (guestbookHTML.length === 0)
                {
                    guestbookEntries.innerHTML = '<p>No entries yet. Add one!</p>';
                }
                else
                {
                    guestbookEntries.innerHTML = guestbookHTML.join('');
                }
	
	        });
    }
    catch (error)
    {
        guestbookEntries.innerHTML = '<p>No entries yet. Add one!</p>';
    }

</script>
</html>